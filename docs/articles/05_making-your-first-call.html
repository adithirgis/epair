<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>2. Making your first call â€¢ epair</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="2. Making your first call">
<meta property="og:description" content="epair">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">epair</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/epair.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/01_ananomyEPARequest.html">The Anatomy of an EPA API request</a>
    </li>
    <li>
      <a href="../articles/02_ClarificationTerm.html">Clarification on terminology</a>
    </li>
    <li>
      <a href="../articles/03_Installation.html">0. Installation</a>
    </li>
    <li>
      <a href="../articles/04_setup.html">1. Setup</a>
    </li>
    <li>
      <a href="../articles/05_making-your-first-call.html">2. Making your first call</a>
    </li>
    <li>
      <a href="../articles/06_make-a-more-complex-call.html">3. Make a more complex call</a>
    </li>
    <li>
      <a href="../articles/07_wrap-up.html">4. Summary</a>
    </li>
    <li>
      <a href="../articles/08_Endpoints.html">Finding Endpoints</a>
    </li>
    <li>
      <a href="../articles/09_Services.html">Navigating API Services</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/GLOrozcoM/epair/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip><ol start="2" style="list-style-type: decimal">
<li>Making your first call</li>
</ol></h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/GLOrozcoM/epair/blob/master/vignettes/05_making-your-first-call.Rmd"><code>vignettes/05_making-your-first-call.Rmd</code></a></small>
      <div class="hidden name"><code>05_making-your-first-call.Rmd</code></div>

    </div>

    
    
<style type="text/css">
pre code {
  white-space: pre-wrap;
}
</style>
<div id="see-what-services-the-api-offers" class="section level1">
<h1 class="hasAnchor">
<a href="#see-what-services-the-api-offers" class="anchor"></a>See what services the API offers</h1>
<p>Be sure to load the package before starting!</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/GLOrozcoM/epair">epair</a></span><span class="op">)</span></code></pre></div>
<p>At the outset, we may not know exactly what we want from the API. We can start by taking a look at the <code>services</code> object included with the package. The <code>services</code> object is an R list that contains information about each service offered by the EPA API and how to use it.</p>
<p>If we just want to see a list of services offered, we can try</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">services</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] "MetaData"                                              
##  [2] "List"                                                  
##  [3] "Monitors"                                              
##  [4] "Sample Data"                                           
##  [5] "Daily Summary Data"                                    
##  [6] "Annual Summary Data"                                   
##  [7] "Quality Assurance - Blanks Data"                       
##  [8] "Quality Assurance - Collocated Assessments"            
##  [9] "Quality Assurance - Flow Rate Verifications"           
## [10] "Quality Assurance - Flow Rate Audits"                  
## [11] "Quality Assurance - One Point Quality Control Raw Data"
## [12] "Quality Assurance - PEP Audits"</code></pre>
<p>If we want to see a description for a particular service, we may type its name and select it from <code>services</code>.</p>
<p>An example for the <code>MetaData</code> service is shown below.</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">services</span><span class="op">[[</span><span class="st">"MetaData"</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">Description</span></code></pre></div>
<pre><code>## [1] "Returns information about the API.  Is it available/up?  What are the meanings of the fields in my returned data?Recent and planned changes, etc."</code></pre>
<p>Using RStudio's smart variable selection, simply typing <code>services$</code> will open up a service to select along with any other useful information about that service.</p>
<div class="figure">
<img src="img/making_first_call/service_selection.png">
</div>
<p>Becoming familiar with the <code>services</code> object can help you to make calls. In the <a href="../../Useful-Features/Services">Navigating services</a> page, we talk in depth about the <code>services</code> object.</p>
</div>
<div id="a-basic-call" class="section level1">
<h1 class="hasAnchor">
<a href="#a-basic-call" class="anchor"></a>A basic call</h1>
<p>In this example, we will attempt to list all parameter codes associated with states in the US.</p>
<div id="setup" class="section level3">
<h3 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h3>
<p>If you haven't already read the Anatomy of an API request, we recommend you do. The post explains how a call is made and may help you in making your own calls.</p>
<p>Remember to set up your authentication first!</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">epa.authentication</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create.authentication.html">create.authentication</a></span><span class="op">(</span><span class="st">"youremail"</span>, <span class="st">"yourAPIkey"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>epa_authentication <span class="op">=</span> <span class="va">epa.authentication</span><span class="op">)</span></code></pre></div>
<p>The package automatically includes the base of the call (the base API site and authentication). To query, we need only provide an endpoint (to see how you can determine an endpoint see the <a href="../../Useful-Features/Endpoints">Finding endpoints</a> page).</p>
</div>
<div id="the-endpoint" class="section level3">
<h3 class="hasAnchor">
<a href="#the-endpoint" class="anchor"></a>The endpoint</h3>
<p>As mentioned above, we need to determine the appropriate endpoint for the type of query we wish to make. Recall that we're looking for all parameter codes associated with each state in the US.</p>
<p>We first look at <code>services</code>, and select <code>List</code>'s description to see if this is the appropriate service to use.</p>
<div class="figure">
<img src="img/making_first_call/list_description.png">
</div>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">services</span><span class="op">$</span><span class="va">List</span><span class="op">$</span><span class="va">Description</span></code></pre></div>
<pre><code>## [1] "Provides information you need to construct other queries.  Valid values for the required variables: parameter code, state code, etc.  (See below.)"</code></pre>
<p>This seems like the perfect service to use to find state parameter codes. We select <code>List</code>, and then see that there are multiple <code>Filters</code> available for listing.</p>
<div class="figure">
<img src="img/making_first_call/list_filters.png">
</div>
<p>It looks like <code>States</code> would be the most appropriate option here.</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">services</span><span class="op">$</span><span class="va">List</span><span class="op">$</span><span class="va">Filters</span><span class="op">$</span><span class="va">States</span></code></pre></div>
<pre><code>## $Endpoint
## [1] "list/states"
## 
## $RequiredVariables
## [1] "email, key"
## 
## $OptionalVariables
## [1] ""
## 
## $Example
## [1] "Returns a list of the states and their FIPS codes used for constructing other requests:https://aqs.epa.gov/data/api/list/states?email=test@aqs.api&amp;key=test"</code></pre>
<p>This shows us the endpoint to use and required variables. Since the <code>email</code> and <code>key</code> are always included in calls, we need only get the endpoint to make the call.</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">endpoint</span> <span class="op">&lt;-</span> <span class="va">services</span><span class="op">$</span><span class="va">List</span><span class="op">$</span><span class="va">Filters</span><span class="op">$</span><span class="va">States</span><span class="op">$</span><span class="va">Endpoint</span></code></pre></div>
<p>After determining the endpoint, we can make the call using <code><a href="../reference/perform.call.html">perform.call()</a></code>.</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/perform.call.html">perform.call</a></span><span class="op">(</span>endpoint <span class="op">=</span> <span class="va">endpoint</span><span class="op">)</span></code></pre></div>
<p>The <code><a href="../reference/perform.call.html">perform.call()</a></code> function will provide an R list with a <code>Header</code> and <code>Data</code> component. The <code>Header</code> contains information about the call and is useful for determining how the call went through.</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">result</span><span class="op">$</span><span class="va">Header</span><span class="op">$</span><span class="va">status</span></code></pre></div>
<pre><code>## [1] "Success"</code></pre>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">result</span><span class="op">$</span><span class="va">Header</span><span class="op">$</span><span class="va">request_time</span></code></pre></div>
<pre><code>## [1] "2021-09-01T20:16:31-04:00"</code></pre>
<p>To get the actual data we called for (states and their parameter codes), we use the <code>Data</code> component of the result.</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">result</span><span class="op">$</span><span class="va">Data</span></code></pre></div>
<pre><code>##    code    value_represented
## 1    01              Alabama
## 2    02               Alaska
## 3    04              Arizona
## 4    05             Arkansas
## 5    06           California
## 6    08             Colorado
## 7    09          Connecticut
## 8    10             Delaware
## 9    11 District Of Columbia
## 10   12              Florida
## 11   13              Georgia
## 12   15               Hawaii
## 13   16                Idaho
## 14   17             Illinois
## 15   18              Indiana
## 16   19                 Iowa
## 17   20               Kansas
## 18   21             Kentucky
## 19   22            Louisiana
## 20   23                Maine
## 21   24             Maryland
## 22   25        Massachusetts
## 23   26             Michigan
## 24   27            Minnesota
## 25   28          Mississippi
## 26   29             Missouri
## 27   30              Montana
## 28   31             Nebraska
## 29   32               Nevada
## 30   33        New Hampshire
## 31   34           New Jersey
## 32   35           New Mexico
## 33   36             New York
## 34   37       North Carolina
## 35   38         North Dakota
## 36   39                 Ohio
## 37   40             Oklahoma
## 38   41               Oregon
## 39   42         Pennsylvania
## 40   44         Rhode Island
## 41   45       South Carolina
## 42   46         South Dakota
## 43   47            Tennessee
## 44   48                Texas
## 45   49                 Utah
## 46   50              Vermont
## 47   51             Virginia
## 48   53           Washington
## 49   54        West Virginia
## 50   55            Wisconsin
## 51   56              Wyoming
## 52   66                 Guam
## 53   72          Puerto Rico
## 54   78       Virgin Islands
## 55   80    Country Of Mexico
## 56   CC               Canada</code></pre>
<p>Alternatively, if you want the original output from the API, <code><a href="../reference/perform.call.raw.html">perform.call.raw()</a></code> will make a request, and provide the request results raw in JSON format.</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">raw.result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/perform.call.raw.html">perform.call.raw</a></span><span class="op">(</span>endpoint <span class="op">=</span> <span class="va">endpoint</span><span class="op">)</span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by G.L. Orozco-Mulfinger, Madyline Lawrence, Owais Gilani.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
