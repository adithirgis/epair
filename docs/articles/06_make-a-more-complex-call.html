<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>3. Make a more complex call â€¢ epair</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="3. Make a more complex call">
<meta property="og:description" content="epair">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">epair</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/epair.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/01_ananomyEPARequest.html">The Anatomy of an EPA API request</a>
    </li>
    <li>
      <a href="../articles/02_ClarificationTerm.html">Clarification on terminology</a>
    </li>
    <li>
      <a href="../articles/03_Installation.html">0. Installation</a>
    </li>
    <li>
      <a href="../articles/04_setup.html">1. Setup</a>
    </li>
    <li>
      <a href="../articles/05_making-your-first-call.html">2. Making your first call</a>
    </li>
    <li>
      <a href="../articles/06_make-a-more-complex-call.html">3. Make a more complex call</a>
    </li>
    <li>
      <a href="../articles/07_wrap-up.html">4. Summary</a>
    </li>
    <li>
      <a href="../articles/08_Endpoints.html">Finding Endpoints</a>
    </li>
    <li>
      <a href="../articles/09_Services.html">Navigating API Services</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/GLOrozcoM/epair/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip><ol start="3" style="list-style-type: decimal">
<li>Make a more complex call</li>
</ol></h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/GLOrozcoM/epair/blob/master/vignettes/06_make-a-more-complex-call.Rmd"><code>vignettes/06_make-a-more-complex-call.Rmd</code></a></small>
      <div class="hidden name"><code>06_make-a-more-complex-call.Rmd</code></div>

    </div>

    
    
<p>Some calls require additional API variables like the state or county of interest. For these calls, we can easily add variables to the base call by passing them in as a second argument to <code><a href="../reference/perform.call.html">perform.call()</a></code>.</p>
<div id="adding-a-single-variable" class="section level1">
<h1 class="hasAnchor">
<a href="#adding-a-single-variable" class="anchor"></a>Adding a single variable</h1>
<p>For example, suppose we want to find out what counties and respective parameter codes exist for North Carolina. We can again use the <code>services</code> object, and check its <code>List</code> service as in <a href="../../docs/Tutorial/making-your-first-call">Making your first call</a>.</p>
<div class="figure">
<img src="img/complex_call/counties_by_state.png">
</div>
<p>It looks like the <code>Counties by state</code> filter would be appropriate since we're trying to determine the county parameter codes for North Carolina.</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">services</span><span class="op">$</span><span class="va">List</span><span class="op">$</span><span class="va">Filters</span><span class="op">$</span><span class="va">`Counties by State`</span></code></pre></div>
<pre><code>## $Endpoint
## [1] "list/countiesByState"
## 
## $RequiredVariables
## [1] "email, key, state"
## 
## $OptionalVariables
## [1] ""
## 
## $Example
## [1] "Example; returns all counties in North Carolina:https://aqs.epa.gov/data/api/list/countiesByState?email=test@aqs.api&amp;key=test&amp;state=37"</code></pre>
<p>Notice we have a required variable <code>state</code>. Since we're looking for counties in North Carolina, we can use the parameter code for North Carolina as the entry for <code>state</code>. We were able to determine all parameter codes for states in <a href="../../docs/Tutorial/making-your-first-call">Making your first call</a> so we look at our output there and find that the parameter code for North Carolina is <code>37</code>.</p>
<p>Now, we can perform the call by putting together the endpoint for listing counties by state and the particular state we're interested.</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">endpoint</span> <span class="op">&lt;-</span> <span class="va">services</span><span class="op">$</span><span class="va">List</span><span class="op">$</span><span class="va">Filters</span><span class="op">$</span><span class="va">`Counties by State`</span><span class="op">$</span><span class="va">Endpoint</span>
<span class="va">state.code</span> <span class="op">&lt;-</span> <span class="st">'37'</span>
<span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/perform.call.html">perform.call</a></span><span class="op">(</span>endpoint <span class="op">=</span> <span class="va">endpoint</span>, variables <span class="op">=</span> <span class="va">state.code</span>, name <span class="op">=</span> <span class="st">"state"</span><span class="op">)</span></code></pre></div>
<p>Note that we specified the additional variables we'd be adding with <code>variables = state.code</code>, and we inserted the API variable name as <code>name = state</code> in the function. An alternative is to simply declare the parameter code with the API variable name as follows.</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">endpoint</span> <span class="op">&lt;-</span> <span class="va">services</span><span class="op">$</span><span class="va">List</span><span class="op">$</span><span class="va">Filters</span><span class="op">$</span><span class="va">`Counties by State`</span><span class="op">$</span><span class="va">Endpoint</span>
<span class="va">state</span> <span class="op">&lt;-</span> <span class="st">'37'</span>
<span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/perform.call.html">perform.call</a></span><span class="op">(</span>endpoint <span class="op">=</span> <span class="va">endpoint</span>, variables <span class="op">=</span> <span class="va">state</span><span class="op">)</span></code></pre></div>
</div>
<div id="adding-multiple-variables" class="section level1">
<h1 class="hasAnchor">
<a href="#adding-multiple-variables" class="anchor"></a>Adding multiple variables</h1>
<p>In the case of multiple variables, we can make a list of variables and pass the list into <code><a href="../reference/perform.call.html">perform.call()</a></code> as the second argument.</p>
<p>Suppose, for instance, we're interested in finding daily ozone data for North Carolina, starting January 1, 2020 and ending on January 2, 2020, and we have determined the correct parameter codes for each API variable (please see <a href="../Useful-Features/Services">Navigating API services</a> or <a href="../../docs/Useful-Features/Variables">Figuring out API variables</a> to understand how we could go about determining proper parameter codes for each of these variables).</p>
<p>Our first option is to make a list of the parameter codes and a list of API variable names that correspond to the parameter codes.</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">endpoint</span> <span class="op">&lt;-</span> <span class="st">'dailyData/byState'</span>
<span class="va">variable.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">'37'</span>,<span class="st">'20200101'</span>,<span class="st">'20200102'</span>,<span class="st">'44201'</span><span class="op">)</span>
<span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/perform.call.html">perform.call</a></span><span class="op">(</span>endpoint <span class="op">=</span> <span class="va">endpoint</span>, 
                       variables <span class="op">=</span> <span class="va">variable.list</span>, 
                       name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"state"</span>, <span class="st">"bdate"</span>, <span class="st">"edate"</span>, <span class="st">"param"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Our second option is to create a list that has the appropriate API variable names declared for parameter codes.</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">endpoint</span> <span class="op">&lt;-</span> <span class="st">'dailyData/byState'</span>
<span class="va">variable.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"state"</span> <span class="op">=</span> <span class="st">'37'</span>, 
                      <span class="st">"bdate"</span> <span class="op">=</span> <span class="st">'20200101'</span>, 
                      <span class="st">"edate"</span> <span class="op">=</span> <span class="st">'20200102'</span>, 
                      <span class="st">"param"</span> <span class="op">=</span> <span class="st">'44201'</span><span class="op">)</span>
<span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/perform.call.html">perform.call</a></span><span class="op">(</span>endpoint <span class="op">=</span> <span class="va">endpoint</span>, variables <span class="op">=</span> <span class="va">variable.list</span><span class="op">)</span></code></pre></div>
</div>
<div id="caching-a-call" class="section level1">
<h1 class="hasAnchor">
<a href="#caching-a-call" class="anchor"></a>Caching a call</h1>
<p>Calling the same large dataset frequently can take time to load each time, but we can cache this data by storing it in the user's specified directory for convenience. In <code><a href="../reference/perform.call.html">perform.call()</a></code> we can specify whether the call is cached or not in the third argument, and the directory the call is saved in for the fourth argument.</p>
<p>For example, if we plan to use the daily ozone data for North Carolina from January 1, 2020 to March 1, 2020 many times over, we can use the last two arguments to specify we want to cache this data.</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">endpoint</span> <span class="op">&lt;-</span> <span class="st">'dailyData/byState'</span>
<span class="va">variable.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"state"</span> <span class="op">=</span> <span class="st">'37'</span>, 
                      <span class="st">"bdate"</span> <span class="op">=</span> <span class="st">'20200101'</span>, 
                      <span class="st">"edate"</span> <span class="op">=</span> <span class="st">'20200301'</span>, 
                      <span class="st">"param"</span> <span class="op">=</span> <span class="st">'44201'</span><span class="op">)</span>
<span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/perform.call.html">perform.call</a></span><span class="op">(</span>endpoint <span class="op">=</span> <span class="va">endpoint</span>, variables <span class="op">=</span> <span class="va">variable.list</span>, cached <span class="op">=</span> <span class="cn">TRUE</span>, directory <span class="op">=</span> <span class="st">"~/epair/cache"</span><span class="op">)</span></code></pre></div>
<p>Without specification of these arguments, the <code><a href="../reference/perform.call.html">perform.call()</a></code> default will always cache the call in the directory "~/epair/cache" based in the current working directory.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by G.L. Orozco-Mulfinger, Madyline Lawrence, Owais Gilani.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
